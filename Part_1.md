# Веб-фреймворк Django

## Часть I Введный курс
Django - популярен потому что:
- Django - это следование современным стандартам веб-разработки. В их числе: архитектура «модель-контроллер-шаблон», использование миграций для внесе­ ния изменений в базу данных и принцип «написанное однажды применяется везде)) (или, другими словами, «не повторяйся))).
- Django - это полнофункциональный фреймворк. Для разработки среднестати­ стического сайта вам достаточно установить только его. Никаких дополнитель­ ных библиотек, необходимых, чтобы ваше веб-творение хотя бы зараб\.Уfало, ставить не придется.
- Django - это высокоуровневый фреймворк. Типовые задачи, наподобие соеди­ нения с базой данных, обработки данных, полученных от пользователя, сохра­ нения выгруженных пользователем файлов, он выполняет самостоятельно. А еще он предоставляет полнофункциональную подсистему разграничения дос­ тупа и исключительно мощный и удобно настраиваемый административный веб-сайт, которые, в случае применения любого другого фреймворка, нам при­ шлось бы писать самостоятельно.
- Django - это удобство разработки. Легкий и быстрый отладочный веб-сервер, развить1й механизм миграций, уже упомянутый административный веб-сайт - все это существенно упрощает программирование.
- Django - это дополнительные библиотеки. Нужен вывод графических миниа­ тюр? Требуется обеспечить аутентификацию посредством социальных сетей? Необходима поддержка САРТСНА? Для всего этого существуют библиотеки, которые нужно только установить.
- Django - это Python. Исключительно мощный и, вероятно, самый лаконичный язык из всех, что применяются в промышленном программировании.


## Глава 1 Основные понятия Django. Вывод данных
- устанавливаем Django
- создаем проект Django

Проект содержит следующие файлы
- `manage.py` - программный файл с кодом одноименной утилиты, с использовани­ем которой производятся различные дейтвия над самим проектом. Впрочем, единственное, чем она занимается - вызывает утилиту django-admin, передавая ей полученные команды и конфигурируя ее для обработки текущего поекта.
- «внутренняя» папка `samplesite` - формирует пакет языка Python, содержащий модули, которые относятся к проекту целиком и задают его конфигурацию (в частности, ключевые настройки). Название этого пакета совпадает с названи­ем проекта и менять его не стоит - в противном случае придется вносить в код обширные правки. Назовем его паке­ том конфигурации.

Пакет конфигурации включает в себя такие модули:
- `__init__.py` - пустой файл, сообщающий Python, что папка, в которой он нахо­ дится, является полноценным пакетом
- `settings.py` - модуль с настройками самого проекта. Включает описание кон­фигурации базы данных проекта, пути ключевых папок, важные параметры, связанные с безопасностью, и пр.
- `urls.ру` - модуль с маршрутами уровня проекта
- `wsgi.py` - модуль, связывающий проект с веб-сервером. Используется при публикации готового сайта в Интернете.
- `asgi.py` - для асинхронных веб-серверов и приложений.

В состав Django входит от­ладочный веб-сервер, написанный на самом языке Python, не требующий сложной настройки и всегда готовый к работе.
###  1.4. Приложения.
- `Приложение` - это отдельный фрагмент функционально­сти разрабатываемого сайта, более или менее независимый от других таких же фрагментов и входящий в состав проекта. Приложение может реализовывать рабо­ту целого сайта, его раздела или же какой-либо внутренней подсистемы сайта, ис­пользуемой другими приложениями.

- `startapp` утилиты manage.py запускает создание нового `пустого` прило­жения, чье имя указано после этой команды.
В папке (проект) находятся следующие файлы
- `migrations` - папка вложенного пакета, в котором будут сохраняться модули сге­нерированных Django миграций. Пока что в папке находится лишь пустой файл _init_.py, помечающий ее как полноценный пакет Python;
- `__init__.py` - пустой файл, сигнализирующий языку Python, что эта папка - па­кет;
- `admin.py` - модуль административных настроек и классов-редакторов;
- `apps.py` - модуль с настройками приложения;
- `models.py` - модуль с моделями, здесь создаются классы, которые являются полным отражением тех таблиц, которые в дальнейшем будут находится в БД;
- `tests.py` - модуль с тестирующими процедурами;
- `views.py` - модуль с контроллерами.

### 1.5. Контроллеры
`Контроллер`- это код, запускаемый в ответ на поступление клиентского запроса, который содержит интернет-адрес определенного формата. Именно в контроллерах выполяются все действия по подготовке данных для вывода, равно как и обработка данных, поступивших от посетителя.
### 1.6. Маршруты и маршрутизатор
Чтобы связать интернет адрес с контроллером нужноЖ
- объявить связь интернет-адреса определенного формата (шаблонного интернет­ адреса) с определенным контроллером- иначе говоря, маршрут. Шаблонный интернет-адрес должен содержать только путь, без названия прото­ кола, адреса хоста, номера порта, набора GЕТ-параметров и имени якоря. Он должен завершаться симво­лом слеша (напротив, начальный слеш недопустим);
- оформить все объявленные нами маршруты в виде списка маршрутов;
- оформить маршруты в строго определенном формате, чтобы подсистема маршрутизатора смогла использовать готовый список в работе.

Список маршрутов, оформленный в виде обычного списка Python, присваивается переменной `urlpatterns`. Каждый элемент списка маршрутов (т. е. каждый мар­шрут) должен представляться в виде результата, возвращаемого функцией path() из модуля django.urls. Последняя в качестве параметров принимает строку с шаб­лонным интернет-адресом и ссылку на контроллер-функцию.

### 1.7. Модели
`Модель` - это исчерпывающее описание сущности, хранящейся в базе данных в виде класса Python. Класс модели описывает таблицу базы данных, в которой будет храниться набор сущностей, и содержит атрибуты класса, каждый из которых описывает одно из полей этой таблицы. Можно сказать, что модель - это представление таблицы и ее полей средствами Python.
- Модели объявляются на уровне приложения. Объявляющий их код должен записы­ваться в модуль models.py пакета приложения.
- `CharField` - обычное строковое поле фиксированной длины. Допустимая длина
значения указывается параметром rnax_length конструктора;
- `TextField` - текстовое поле неограниченной длины
- `FloatField` - поле для хранения вещественных чисел. Оно также необязательно для заполнения (ам. набор параметров его конструктора);
- `DateTimeField`- поле для хранения отметки даты и времени. Присвоив пара­ метру auto_now_add конструктора значение True, мы предпишем Django при соз­ дании новой записи записывать в это поле текущие дату и время. А параметр dЬ_index при присваивании ему значения тrue укажет создать для этого поля индекс (при выводе объявлений мы будем сортировать их по убыванию даты публикации, и индекс здесь очень пригодится).
- `Миграция` - это модуль Python, созданный самим Django на основе определенной модели и предназначенный для формирования в базе данных всех требуемых этой моделью структур: таблиц, полей, индексов, правил и связей. Еще один замеча­тельный инструмент фреймворка, заметно упрощающий жизнь программистам.

### 1.9. Консоль Django
`python manage.py shell`

### 1.10. Работа с моделями
b2 = Bb() - создание объекта
b2.save() - сохранение объекта
b2.pk - значение ключевого поля текущей записи
Bb.objects.create(title='Дом', content='Трехэтажный, кирпич', price=50000000) - - создание объекта
- Метод `create()` диспетчера записей создает новую запись модели, принимая в качестве набора именованных параметров значения ее полей.
- Метод `all()` диспетчера записей возвращает так называемый набор записей - по­ следовательность, содержащую записи модели, в нашем случае - все, что есть в базе данных.
- `Queryset`  - набор записей в  бд
- Метод `order_by()` диспетчера записей сортирует записи по значению поля, чье имя указано в параметре, и сразу же возвращает получившийся в результате сортировки набор записей.
- Метод `filter()` диспетчера записей выполняет фильтрацию записей по заданным критериям. В частности, чтобы получить только записи, у которых определенное поле содержит заданное значение, следует указать в вызове этого метода имено­ ванный параметр, чье имя совпадает с именем поля, и присвоить ему значение, которое должно содержаться в указанном поле.
- Метод `get ()` диспетчера записей имеет то же назначение, что и метод `filter()`, и вызывается аналогичным образом. Однако он ищет не все записи, подходящие под заданные критерии, а лишь одну и возвращает ее в качестве результата.
- Метод `delete()` модели, как уже понятно, удаляет текущую запись и возвращает сведения о количестве удаленных записей, обычно малополезные.

### 1.11. Шаблоны
- `Шаблон` - это образец для формирования документа, который будет представлен клиенту: веб-страницы, файла в формате XML, PDF и пр. Подсистема Django, называемая шаблонизатором, загружает шаблон, объединяет его с данными, извле­ченными из моделей, полученными от посетителя или сгенерированными в процес­се работы, и формирует на основе всего этого полноценный документ, который и отправляется клиенту.

Команды шабланизатора

	(% for bb in bbs %)
	...
	(% endfor %)
	(( bb.title ))

### 1.12. Рендеринг шаблонов. Сокращения
- `get_template()` - загружаем шаблон
t_
- `Контекстом шаблона` называ­ется набор данных, которые должны быть доступны внутри шаблона в виде пере­менyых и с которыми шаблонизатор объединит этот шаблон для получения выход­ного документа. Контекст шаблона должен представлять собой обычный словарь Python, ключи элементов которого станут переменными, доступными в шаблоне, а значения элементов - значениями этих переменных.
<img width="558" alt="image" src="https://user-images.githubusercontent.com/58044383/211074395-2ca4102e-fa4a-4a91-bea9-69e54bd62509.png">

### 1.13. Административный веб-сайт Django
- `Административный веб-сайт` предоставляет доступ ко всем моделям, объявлен­ным во всех приложениях, что составляют проект. Мы можем просматривать, до­бавлять, править и удалять записи, выполнять их фильтрацию и сортировку. Поми­мо этого, административный сайт не пускает к данным сайта посторонних, исполь­зуя для этого встроенную во фреймворк подсистему разграничения доступа.
`LANGUAGE_CODE = 'ru-ru'` - меняет в админке язык на русский

- Чтобы приложение появилось в списке административного сайта, его нужно явно зарегестрировать там. Делается это в файле `admin.py`
(сначала импортируем модель, а потом применяем к ней метод `register()`)

### 1.14. Параметры полей и моделей
- `verbose_name` - указывает "человеческое" название поля, которое будет выводиться на экран.
- класс Meta - в нем - атрибуты класса, которые зададут параметры уже самой модели:
	- `verbose_name_plural` - название модели во множественном числе;
	- `verbose_name` - название модели в единственном числе.
	- `ordering` - последовательность полей, по которым по умолчанию будет выполняться сортировка записей.

### 1.15. Редактор модели
- `list_display` - последовательность имен полей, которые должны выводиться в списке записей;
- `list_display_links` - последовательность имен полей, которые должны быть преобразованы в гиперссылки, ведущие на страницу правки записи;
- `search_fields` - последовательность имен полей, по которым должна выполняться фильтрация.
<img width="1199" alt="image" src="https://user-images.githubusercontent.com/58044383/211074705-d4b18d11-0b9f-45e5-a15d-f17c6a3f21d3.png">


### Глава II Связи. Ввод данных. Статические файлы.

### 2.1. Связи между моделями
- `Связь "один-со-многими"` - связь при которой одна запись модели Rubric (рубрика) будет связана с произвольным количеством записей модели Bb (объявлений).
- Для создания связи нужно добавить в модель Bb поле внешнего ключа
- Класс `ForeignKey` представляет поле внешнего ключа, в котором фактически будет храниться ключ записи из первичной модели. Первым параметром конструктору этого класса передается класс первичной модели в виде:
	- ссылки на класс - если код, объявляющий класс первичной модели, располага­ется перед кодом класса вторичной модели;
	- строки с именем класса - если вторичная модель объявлена раньше первичной (как у нас).
- `null=True` - делает поле необязательное, только после этого поле будет успешно добавлено в модель.
- `on_delete` - этот параметр управляет каскадными удалениями записей вторичной модели после удаления записи первичной модели, с которой они бьmи связаны.
- `PROTECT` - Значение этого параметра запрещает каскадные удаления (чтобы какой-нибудь несообразительный администратор не удалил разом сразу уйму объявлений).

- Модель необходими сразуже регестрировать на административном сайте, добавив в мо­ дуль `admiп.py` пакета приложения такие два выражения:
	- `from .models import Rubric`
	- `admin.site.register(Rubric)`

### 2.2. Строковое представление модели
- `__str__` - переопределив этот метод мы будем возвращать строковое предстваление класса

### 2.3. URL-параметры и параметризованные запросы
Указываем маршрутизатору, какую часть пути считать URL- параметром, каков тип значения этого параметра, и какое имя должно быть у пара­метра контроллера, которому будет присвоено значение этого URL-параметра.
- В начало набора маршрутов добавляем еще один `path('<int:rubric_id>/', by_rubric)`
	- `<  >`угловые скобки обозначают описание URL-пара­метра
	- языковая конструкция `int` - целочисленный тип этого параметра
	- `rubric_id` - имя параметра контроллера, которому будет присвоено значение этого URL-параметра.
	- `by_rubric` - контроллер-функция для созданного маршрута
- маршруты, содержащие URL-параметры, носят название `параметризо­ванных`.

### 2.4 Обратное разрешение интернет-адресов
- Обратное разрешение -  мы указываем маршрут, формирующий нужный нам интернет-адрес, и, если это параметризован­ный маршрут, значения URL-параметров, а Django сам генерирует на основе всего этого правильный интернет-адрес. Для этого следует выполнить два действия:
	- Первое - дать нужным маршрутам имена, создав тем самым именованные маршру­ты.
	- Второе - использование для создания интернет-адресов в гиперссьmках тегов шаблонизатора url.

### 2.5. Формы, связанные с моделями
Для ввода данных (наример для добавления в базу данных новых объ­явлений) язык HTML предлагает так называемые веб-формы. Джанго умеет это делать для этого в файле `forms.py` создаем класс наследуясь от `ModelForm` в котором указываем параметры нашей формы: класс модели, с которой она связана (атри­бут класса model), и последовательность из имен полей модели, которые должны присутствовать в форме (атрибут класса fields)

### 2.6. Контроллеры-классы
Базовый класс реализует функциональность по созданию формы, выводу ее на экран с применением указанного шаблона, получению занесенных в форму данных, проверке и на корректность, сохранению их в новой записи модели и перенапралению в случае успеха на интернет-адресс, который мы зададим
- `template_name` - путь к файлу шаблона, что будет использован для вывода стра­ницы с формой;
- `form_class` - сам класс формы, связанной с моделью;
- `success_url` - интернет-адрес, по которому будет выполнено перенаправление после успешного сохранения данных (в нашем случае это адрес главной стра­ницы).
- `get_context_data` - этот Метод, этого класса формирует контекст шаблона

Создание веб-формы
- форма в контексте шаблона хранится в переменной `form`. Эту переменную созда­ет базовый класс `CreateView`;
- для вывода формы, чьи элементы управления находятся на отдельных абзацах, применяется метод `as_p()` класса `ModelForm`;
- метод `as_p()` генерирует только код, создающий элементы управления. Тег `<form>`, необходимый для создания самой формы, и тег `<input>`, формирующий кнопку отправки данных, нам придется вставить самостоятельно.
- в теге `<form> `мы поместили тег шаблонизатора `csrf_token`. Он создает в форме скрытое поле, хранящее цифровой жетон, получив который, контроллер «пой­мет», что данные бьли отправлены с текущего сайта, и им можно доверять. Это часть подсистемы обеспечения безопасности Django.
- Функция `reverse_lazy()` из модуля `django.urls` в качестве параметров принимает имя маршруrа и значения всех входящих в маршруr URL-параметров (если они там есть). Результатом станет готовый интернет-адрес.
<img width="508" alt="image" src="https://user-images.githubusercontent.com/58044383/211330084-33452378-516d-46df-a843-84abf49680cc.png">

### 2.7. Наследование wаблонов
Шаблон, являющийся базовым, объявляет в составе своего содержимого так назы­ ваемые блоки. Они определяют место в шаблоне, куда будет вставлено содержимое, извлеченное из шаблонов, которые стануn производными по отношению к базово­му. Каждый из блоков имеет уникальное в пределах шаблона имя.
- `title` - будет помещаться в теге `<title>` и использоваться для создания уни­ кального названия для каждой страницы;
- `content` - будет использоваться для размещения уникального содержимого страниц.

- Начало объявляемого блока помечается тегом шаблонизатора `blосk`, за которым должно следовать имя блока. Завершается блок тегом `endblock`.
- Объявленный в базовом шаблоне блок может быть как пустым:
	{% blосk content %}
	{% endblock %}
- так и иметь какое-либо изначальное содержимое:
	(% blосk title %}Главная{% endblock %}
- В самом начале кода mобого производного шаблона должен стоять тег шаблониза­тора `extends`, после котuрого записывается путь к базовому шаблону.

### 2.8. Статические файлы
Статические файлы - файлы, содержимое которых не обрабатывается программно, а пересьmается клиенrу как есть. К таким файлам относятся, например, таблицы стилей и графические изображения, поме­щаемые на страницы.
- По умолчанию Django требует, чтобы статические файлы, относящиеся к опреде­ ленному приложению, помещались в папке `static` пакета этого приложения
- Чтобы сформировать интернет-адрес статического файла, нужно использовать тег шаблонизатора `static`.
<img width="766" alt="image" src="https://user-images.githubusercontent.com/58044383/211375298-23f4ad69-cf1a-4e77-a0cd-e11968d63e0d.png">
